# Тестирование пешеходного роутинга OSRM

## Что изменилось

**Старый подход:** 2GIS Directions API (50 запросов/день)
**Новый подход:** OSRM Public API (бесплатно, без лимитов)

## Как проверить что роутинг пешеходный

### 1. Откройте консоль браузера (F12)

### 2. Создайте маршрут через персонализацию

Перейдите на `/personalize` и создайте маршрут.

### 3. Проверьте логи в консоли

Вы должны увидеть логи от OSRM API:

```
OSRM Routing API request: https://router.project-osrm.org/route/v1/foot/30.314,59.938;30.340,59.934?overview=full&geometries=polyline&steps=true
```

**Обратите внимание на `/foot/` в URL** - это профиль для пешеходного маршрута.

### 4. Проверьте ответ API

В консоли должен быть лог:

```
OSRM Routing API response: {
  routes: [{
    distance: 2341.5,  // расстояние в метрах
    duration: 1672.5,  // время в секундах
    geometry: "...",   // закодированный polyline
    legs: [...]
  }]
}
```

### 5. Проверьте парсинг

Должен быть лог:

```
OSRM parsed: {
  coordinates: 156,      // количество точек маршрута
  distance: 2341.5,      // метры
  duration: 1672.5,      // секунды
  instructions: 12       // количество инструкций
}
```

**Много точек координат (100+) = детальный пешеходный маршрут**

## Различия между пешеходным и автомобильным

### Пешеходный маршрут (`/foot/`):
- Использует тротуары и пешеходные дорожки
- Может идти через парки и пешеходные зоны
- Короткие расстояния, много поворотов
- Скорость ~1.4 м/с (5 км/ч)

### Автомобильный маршрут (`/car/`):
- Использует только дороги для автомобилей
- НЕ может ехать через парки
- Длинные прямые участки
- Скорость зависит от дороги

## Тест в браузере

1. Откройте dev tools (F12)
2. Перейдите на вкладку Network
3. Отфильтруйте запросы по "router.project-osrm.org"
4. Создайте маршрут
5. Проверьте URL запроса - должен содержать `/foot/`

## Проверка на карте

Пешеходный маршрут должен:
- Идти по тротуарам вдоль дорог
- Использовать пешеходные переходы
- Проходить через парки напрямик (если есть дорожки)
- НЕ идти по проезжей части

Автомобильный маршрут (если бы использовали):
- Только по дорогам для машин
- Длиннее, чем пешеходный
- Объезжает пешеходные зоны

## Если видите прямые линии

Если вместо реального маршрута видите прямые линии между точками:

1. Проверьте консоль на ошибки OSRM API
2. Проверьте что используется профиль `/foot/` а не `/car/`
3. Проверьте что координаты валидные (lat/lon не перепутаны)
4. Fallback на прямые линии срабатывает при ошибке API

## OSRM endpoints

- **Пешеход:** `https://router.project-osrm.org/route/v1/foot/{lon},{lat};{lon},{lat}`
- **Велосипед:** `https://router.project-osrm.org/route/v1/bike/{lon},{lat};{lon},{lat}`
- **Авто:** `https://router.project-osrm.org/route/v1/car/{lon},{lat};{lon},{lat}`

Мы используем **foot** для пешеходных маршрутов.
